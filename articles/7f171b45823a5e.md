---
title: "ObsidianでUUIDをファイル名に使い、assets用のUUIDディレクトリを自動作成する"
emoji: "🐧"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["obsidian"]
published: true
publication_name: "bita"
---
🎄この記事は bitA Tech Blog Advent Calendar の11日目の記事です。

## なぜUUIDをファイル名にしたのか
現実でノートを取る場合と違い、Obisidianではノートに重複しないファイル名を付ける必要があります。

私はノートを書き始める段階で「重複しない」かつ「適切」なファイル名を考えることを面倒に感じたため、UUIDをファイル名に使うことにしました。
また、UUIDをファイル名にするとそのままブログ記事のURLに使えるというメリットもあります。

UUIDがファイル名になるので、Obsidianのファイルツリーで見づらくなると思われるかもしれませんが、後述する[obsidian-front-matter-title](https://github.com/snezhig/obsidian-front-matter-title)プラグインで解決します。

## 本記事の内容
本記事ではObsidianの[Templater](https://github.com/SilentVoid13/Templater) プラグインを使って、新規ノート作成時にUUIDをファイル名としてノートを自動作成する方法を紹介します。
同時に、そのノートに関連するアセット用ディレクトリも自動作成する方法を紹介します。

Templaterプラグインは`.md`のノートに変数やスクリプトを埋め込んで、ノート作成時に動的に内容を生成できるプラグインです。JavaScriptのコードも実行できます。

最終的には以下のようなノートとアセット用ディレクトリが自動作成されるようになります。
![UUIDのノートとassets/UUID/のディレクトリが生成された画像](/images/7f171b45823a5e/9-UUID-generated.png)

ディレクトリ構成をまとめると以下のようになります。
```
articles/
├── 4c1c09e6-0b14-4429-824b-f0ec38aa8886.md # 新規作成したメモ
└── assets/
    └── 4c1c09e6-0b14-4429-824b-f0ec38aa8886/
        └── <your-assets>.png 
```
また、UUIDがファイル名だとファイルツリーで中身がわからなくて不便なため、冒頭でも少し触れた[obsidian-front-matter-title](
https://github.com/snezhig/obsidian-front-matter-title)プラグインをつかって、ノートのYAML front matter[^1]にある`title`をファイルツリーに表示する方法も簡単に紹介します。

[^1]: YAML front matterとは、markdownファイルの先頭にある`---`で囲まれたメタデータ部分のことです。Obsidianではノートのタイトルや作成日時、タグなどをここに記述できます。

## Templaterのインストール
Obsidianを開きます。
設定を開き、左のメニューからCommunity Plugins->Browseを押します。
![Community plugins選択画面](/images/7f171b45823a5e/0-community-plugins-browse.png)

検索欄からTemplaterを調べてインストールします。
![Templaterプラグインインストール画面](/images/7f171b45823a5e/1-templater-install.png)

Installを押したら、Enableを押してプラグインを有効化します。
![Templaterプラグイン有効化画面](/images/7f171b45823a5e/2-templater-enable.png)

これでTemplaterのインストールは完了です。

## ディレクトリ構成
Obsidianは以下のようなディレクトリ構成にします。
```
.
├── articles/        # ノート保存場所
│   └── assets/      # ノートに関連する画像などの保存場所
└── templater/       # templaterで使用するtemplateの保存場所
```

![ディレクトリ構造](/images/7f171b45823a5e/directory-structure.png)

最終的には以下のように、ファイル名がUUIDになったノートとUUIDディレクトリがassets配下に作成されるようにします。

```
.
├── articles/
│   ├── 4c1c09e6-0b14-4429-824b-f0ec38aa8886.md
│   └── assets/
│       └── 4c1c09e6-0b14-4429-824b-f0ec38aa8886/
│           └── <your-assets>.png
└── templater/
```

## Templaterの設定
`templater`ディレクトリ配下に、Templaterで使うテンプレートファイルを作成します。
ファイル名は`uuid-note-and-assets.md`という名前にします。

Templaterでは、Makdownファイルに`<%`, ` %>`もしくは`<%*`, `_%>`で囲んだJavaScriptのコードを書いて動的に処理を実行できます。下記のコードでもそれを使ってUUIDの生成とノート・ディレクトリの作成を行います。

```js: templater/uuid-note-and-assets.md
---
title: ""
created: <% tp.date.now() %>
updated: <% tp.date.now() %>
tags: []
aliases: []
---

<%*
const uuid = window.crypto.randomUUID();

// 1. create ${uuid}.md file
const distPath = `articles/${uuid}.md`;
await tp.file.move(distPath);

// 2. create Asset folder by using ${uuid}
// using Obsidian core API（app.vault.createFolder）instead of tp.file.move() 
const assetsPath = `articles/assets/${uuid}`;

try {
    await app.vault.createFolder(assetsPath);
    new Notice(`[Templater]: Assets was created successfully`, 4000);
} catch (e) {
    if (!e.message.includes("Folder already exists")) {
        console.error("[Templater]: Assets:", e);
        new Notice(`error occurred when creating Asset folder`, 5000);
    }
}
_%>
```

処理を簡単に説明すると、
1. `window.crypto.randomUUID()`でUUIDを生成
2. `tp.file.move()`で`articles/<UUID>.md`ファイルを作成
3. `app.vault.createFolder()`で`articles/assets/<UUID>/`ディレクトリを作成
となります。

3のディレクトリの作成ですが、`tp.file.move()`を使うと現在ノートに対して移動とリネームをしてしまうので、`assets`配下にディレクトリを作成することはできません。
そのため、ObsidianのCore APIを使用して`assets`配下のディレクトリを作っています。

上記のように`templater/uuid-note-and-assets.md`を作成するとYAML front matterに記載した内容がPropertiesで表示され、以下のような表示になります。
![uuid-note-and-assets.md ノート画面](/images/7f171b45823a5e/3-yaml-frontmatter.png)

以上で、テンプレートの作成は完了です。

## Hotkeysからテンプレートを呼び出す
Hotkeysを使って、特定のキーを押したときに`templater/uuid-note-and-assets.md`で定義したテンプレート通りのメモが作成されるようにします。

まず、Community PluginsからTemplaterのOptionsを開きます。
![Optionsから登録](/images/7f171b45823a5e/4-templater-options.png)

Template hotkeysから、先ほど作った`templater/uuid-note-and-assets.md`を選択します。

![Template hotkeysからtemplater/uuid-note-and-assets.mdを選択](/images/7f171b45823a5e/5-template-hotkeys.png)

左のメニューバーから、Hotkeysを押します。
![HotKeys画面へ移動](/images/7f171b45823a5e/6-hotkeys-settings.png)

検索欄から`Templater: Create templater/uuid-note-and-assets.md`を検索します。
右のプラスボタンを押して、Customize this commandから好きなキーを割り当てます。
![Templater: Insert templater/uuid-note-and-assets.md の右のプラスボタンをクリックしてキー割り当て](/images/7f171b45823a5e/7-hotkey-assign.png)

今回はCtrl+Nを割り当てます。
Ctrl+Nにすでに別のコマンドを割り当てている場合は、Ctrl+Nの割り当てを解除するか、TemplaterのキーにCtrl+N以外を使うなどして、キー同士が重複しないように注意してください。
![重複しない適当なコマンドを入力、ここではCtrl+N](/images/7f171b45823a5e/8-hotkey-ctrl-n.png)

これでCtrl+Nを押すと、UUID形式のノートとアセット用ディレクトリが自動作成されるようになりました。
![UUIDのノートとassets/UUID/のディレクトリが生成された画像](/images/7f171b45823a5e/9-UUID-generated.png)

## YAML front matterのtitleをファイルツリーに表示する(obsidian-front-matter-title プラグイン)
ファイル名がUUIDのままだと、ファイルツリー画面から探しにくいので、
[obsidian-front-matter-title](https://github.com/snezhig/obsidian-front-matter-title)を導入して、YAML front matterの`title`に書いた名前がファイルツリーに表示されるようにします。

Templaterと同様に、Community PluginsからFront Matter Titleプラグインをインストールします。

![プラグインインストール画面からFront Matter Titleを検索](/images/7f171b45823a5e/10-front-matter-title-search.png)

インストールしたらEnableを押して有効化します。
![インストール後にEnableを押して有効化](/images/7f171b45823a5e/11-front-matter-title-enable.png)

その後Optionsから、Explorerのトグルを有効化します。
![Explorerのトグルを有効化](/images/7f171b45823a5e/12-explorer-option.png)


これで、YAML front matterの`title`に指定してある`This is sample`がファイルツリーでも表示されるようになります。
![FrontmatterのtitleをExplorerに表示](/images/7f171b45823a5e/13-explorer-title-display.png)

## 参考資料
https://note.com/sho7650/n/neb88ef32cd45

https://note.syufu.dev/35d93b2d-220d-44f9-a74f-2453a3c29854

https://silentvoid13.github.io/Templater/

https://github.com/SilentVoid13/Templater

https://github.com/snezhig/obsidian-front-matter-title

