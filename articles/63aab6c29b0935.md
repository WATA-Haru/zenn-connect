---
title: "T | undefined extends Tã®è§£é‡ˆã‚’é–“é•ã£ã¦ã„ãŸè©±"
emoji: "ğŸ™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [typescript]
published: false
---

extends ã‚’å˜èªã§è¦‹ã¦ã¿ã‚‹ã¨ã€extendsã¯ä½•ã‹ã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ã ã€‚
T extends UãŒã‚ã£ãŸã‚‰ã€Tã¯Uã«æ‹¡å¼µã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã€Tã¯Uã®ä¸‹ä½é›†åˆã«ãªã‚‹ã€‚

>TypeScriptã§ã¯extendsã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã®å‹Tã‚’ç‰¹å®šã®å‹ã«é™å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå›ã®ä¾‹ã§ã¯`<T extends HTMLElement>`ã¨ã™ã‚‹ã“ã¨ã§å‹Tã¯å¿…ãšHTMLElementã¾ãŸã¯ãã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã®HTMLButtonElementã‚„HTMLDivElementã§ã‚ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹ãŸã‚styleãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
https://typescriptbook.jp/reference/generics/type-parameter-constraint#%E5%9E%8B%E5%BC%95%E6%95%B0%E3%81%AB%E5%88%B6%E7%B4%84%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B

ä»Šã¾ã§ã€`T extends string`ã®ã‚ˆã†ã«ã€TãŒstringã®å ´åˆã¿ãŸã„ã«ã€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§Tã‚’argsã®ã‚ˆã†ã«è€ƒãˆã¦ã„ãŸã®ã§Tã«ãƒ¦ãƒ‹ã‚ªãƒ³å‹ã‚’å…¥ã‚ŒãŸå ´åˆã«èª¤ã£ãŸèªè­˜ã‚’ã—ã¦ã„ãŸã€‚

## æ­£ã—ã„extendsã®èªè­˜ã¨å®Ÿå‹™ã®ã‚³ãƒ¼ãƒ‰ã®è§£é‡ˆ
åŸºæœ¬ã«ç«‹ã¡è¿”ã‚‹ã¨ã€`T extends T | X`ã¯ã‚‚ã¡ã‚ã‚“æˆã‚Šç«‹ã¤ã€‚
`T | X extends T | X` ã‚‚æˆã‚Šç«‹ã¤ã€‚
ã—ã‹ã—ã€`T | X extends T`ã¯æˆã‚Šç«‹ãŸãªã„ã€‚
å†·é™ã«è€ƒãˆã‚Œã°é–“é•ã‚ãªãã†ã ãŒã€
å®Ÿéš›ã®ä¾‹ã§ã¯ã€Tã«`ResponseType | undefined` ãŒå…¥ã‚‹å®Ÿè£…ã§ã€
ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ãŸã€‚

```ts
type IsNullable<K> = K extends (undefined | null) ? true : false
type GetRequestBody<
  Path extends keyof paths,
  Method extends Lowercase<HttpMethods>,
> =
  IsNullable<paths[Path][Method]> extends true
    ? never
    : NonNullable<paths[Path][Method]>["requestBody"] extends 
        | {
            content: {
              "application/json": infer RequestBody;
            };
          }
        | undefined
      ? RequestBody
      : never;
```

pathã¨methodã‚’å—ã‘å–ã‚‹ã€‚
ãã—ã¦ã€`NonNullable<paths[Path][Method]>["requestBody"]`ã¯ `{ content: { "application/json": infer RequestBody }}` ã‚‚ã—ãã¯`undefined`ã‚’å—ã‘å–ã‚‹ã€‚

extendsã§ã€
```ts
{ content: { "application/json": infer RequestBody; }; } | undefined
```
ãŒtrueã®å ´åˆã¯`RequestBody`ã‚’è¿”ã™ã€‚undefinedãŒè¿”ã£ã¦ããŸå ´åˆã¯`RequestBody`ã¯`unknow`ã«ãªã‚‹ã®ã§ã€å…¨ä½“ã®æˆ»ã‚Šå€¤ã¯`paths[Path][Method]["requestBody"]` ã®æˆ»ã‚Šå€¤ `| unknown`ã«ãªã‚‹ã€‚

```ts
: NonNullable<paths[Path][Method]>["requestBody"] extends 
    | {
        content: {
          "application/json": infer RequestBody;
        };
      }
    | undefined
  ? RequestBody
  : never;
```

## èª¤ã£ãŸèªè­˜
ä»¥ä¸‹ã®ã‚ˆã†ã«`undefined`ãŒã„ã‚‰ãªã„ã¨æ€ã£ã¦ã„ãŸã€‚
å®Ÿè¡Œæ™‚ã«å‹ãŒæ±ºã¾ã‚‹ã¨ã„ã†èªè­˜ã§å‹ã‚’æ›¸ã„ã¦ã„ãŸãŒã€å‹ãƒ¬ãƒ™ãƒ«ã®è©±ã§ã¯å®Ÿè¡Œæ™‚ã‚‚ä½•ã‚‚ãªã„ã®ã§ãã“ãŒèªè­˜é•ã„ã ã£ãŸã€‚

**é–“é•ã£ãŸèªè­˜**

`NonNullable<paths[Path][Method]>["requestBody"]` ãŒ`undefined`ã®å ´åˆã¯conditional typeãŒ`undefined`ã§falsyãªå€¤ã«ãªã‚‹ã®ã§`never`å‹ãŒè¿”ã‚‹  
`NonNullable<paths[Path][Method]>["requestBody"]` ãŒ`content`ã®å ´åˆã¯ã€`RequestBody`ãŒè¿”ã‚‹ã€‚ã—ãŸãŒã£ã¦ä¸‹è¨˜ã®æ›¸ãæ–¹ã§ã‚ˆã„ã¨æ€ã£ã¦ã„ãŸã€‚

ã—ã‹ã—...ä¸‹è¨˜ã¯å¿…ãš`never`å‹ã«ãªã‚‹ã€‚  
ãªãœãªã‚‰ã€å‹ã¨å®Ÿè£…æ™‚ã§è€ƒãˆæ–¹ãŒé•ã†ã‹ã‚‰ã ã€‚å®Ÿéš›ã«ã¯  
`NonNullable<paths[Path][Method]>["requestBody"]` ã¯`content | undefined`ã§ã‚ã‚‹ã€‚  
`content`ã®ã¿ã§ã¯`content | undefined`ã®ä¸Šä½é›†åˆã«æ…£ã‚Œãªã„ãŸã‚ã€  
`content | undefined extends content` ã¯å¸¸ã«falsyã«ãªã‚‹ã€‚  
ã—ãŸãŒã£ã¦ã€å¸¸ã«è¿”ã‚Šå€¤ãŒ`never`ã«ãªã‚‹ã€‚

```ts
: NonNullable<paths[Path][Method]>["requestBody"] extends {
    content: {
      "application/json": infer RequestBody;
    };
  }
  ? RequestBody
  : never;
```

