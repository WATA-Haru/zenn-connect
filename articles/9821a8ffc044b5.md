---
title: NVIM_APPNAMEを使ってNeovimのサブ環境を複数作る
emoji: 🐡
type: tech
topics:
  - Neovim
published: true
publication_name: bita
---
🎄この記事は bitA Tech Blog Advent Calendar の17日目の記事です。

## はじめに
Neovimの実験用の環境を作りたい場合や、ほかの人のdotfilesを試してみたい場合にNeovimのサブ環境が欲しくなります。
このような場合にNeovimの`NVIM_APPNAME`を使うと複数のNeovim環境を作れて便利だったので紹介します。

:::message
以下では`NVIM_APPNAME`を概念を表す言葉として使いますが、環境変数そのものを指す場合は`$NVIM_APPNAME`と表記します。
:::

## `NVIM_APPNAME`とはなにか
`$NVIM_APPNAME`はNeovimが使う設定用ディレクトリを制御する環境変数です。Unix系では`~/.config/nvim`、Windowsでは`~/AppData/Local/nvim`から設定を読み込みますが、`$NVIM_APPNAME`の値を変えることで設定の読込先を変更できます。

公式ドキュメントで`NVIM_APPNAME`の定義を確認します。
https://neovim.io/doc/user/starting.html#%24NVIM_APPNAME

以下、公式ドキュメントの説明を引用して翻訳したものになります。
> The standard directories can be further configured by the `$NVIM_APPNAME` environment variable.

標準ディレクトリは`$NVIM_APPNAME`環境変数で設定できます。

> This variable controls the sub-directory that Nvim will read from (and auto-create) in each of the base directories. 

この変数(`$NVIM_APPNAME`)はNvimが各ベースディレクトリ内で読み込む(および自動作成する)サブディレクトリを制御します。

> For example, setting `$NVIM_APPNAME` to "foo" before starting will cause Nvim to look for configuration files in `$XDG_CONFIG_HOME/foo` instead of `$XDG_CONFIG_HOME/nvim`. `$NVIM_APPNAME` must be a name, such as "foo", or a relative path, such as "foo/bar".

例えば、Nvimがスタートする前に`$NVIM_APPNAME`として`foo`を設定用ディレクトリとしていたら、Nvimは`$XDG_CONFIG_HOME/nvim`の代わりに`$XDG_CONFIG_HOME/foo`を参照するようになります。
その際、`$NVIM_APPNAME`は必ず"foo"のような名前、もしくは"foo/bar"のような相対パスでなければなりません。

補足すると、`$XDG_CONFIG_HOME`はUnix系だと`~/.config`でWindowsだと`~/AppData/Local`になります。
https://neovim.io/doc/user/starting.html#standard-path

## `NVIM_APPNAME`の設定手順
`NVIM_APPNAME`の設定は、以下の手順で簡単に作成できます。
### 1. Neovimの設定用ディレクトリ(`$XDG_CONFIG_HOME/<your-config>/`)の用意
`$XDG_CONFIG_HOME`配下にNeovimの設定用ディレクトリを作成します。
前述の通りUnix系では`~/.config`、Windowsでは`~/AppData/Local`が`$XDG_CONFIG_HOME`になります。私はUbuntuを使っているので以下`~/.config`を`$XDG_CONFIG_HOME`として進めます。

以下のように、好きな名前で`~/.config`配下にNeovimの設定用ディレクトリを作成してください。
```sh
.config
  ├── nvim
  └── nvim-with-denops # 試したいNeovimの設定用ディレクトリ
```

余談ですが、私は[denops.nvim](https://github.com/vim-denops/denops.vim)を試したかったので`nvim-with-denops`という名前の設定用ディレクトリを作成しました。

### 2. `NVIM_APPNAME`に使いたい設定用ディレクトリのパスを追加

`NVIM_APPNAME`に1で作った設定用ディレクトリ名を指定してNeovimを立ち上げます。
先に述べたように相対パスを使わずにディレクトリ名だけを指定してください。
(`NVIM_APPNAME=~/.config/<your-dir-name>`とはしないでください。)

```shell
NVIM_APPNAME=<your-dir-name> nvim
```

私の例だと`NVIM_APPNAME=nvim-with-denops nvim`のように打って実行します。
正しくディレクトリ名を指定していれば、`<your-dir-name>`の設定が読み込まれているはずです。

### 3. Shellのaliasに設定を追加(お好みで)
直接Neovimの機能には関係しませんが、`$NVIM_APPNAME`を`alias`と紐づけるとすぐ開けるようになって便利なのでお好みで設定してください。

以下のコマンドでは`nn`を押すと`nvim-with-denops`が設定用ディレクトリとして読み込まれてNeovimが立ち上がります。[fish](https://fishshell.com/)でも書き方は同じです。

以下は`.zshrc`に追加する例です。

```shell:.zshrc
alias nn='NVIM_APPNAME=nvim-with-denops nvim'
```
設定後は`source ~/.zshrc`のように、`source`を使って自分のshellの設定ファイルを読み込んでください。もしくはターミナルの再起動で設定を反映してください。

これで`nn`を打つと`nvim-with-denops`が設定用ディレクトリとして読み込まれてNeovimが立ち上がります。

Neovimのサブ環境の作成とaliasの設定は以上です。

## 参考

https://neovim.io/doc/user/starting.html#%24NVIM_APPNAME

https://neovim.io/doc/user/starting.html#standard-path
